{"ast":null,"code":"var httpProxy = module.exports,\n    extend = require('util')._extend,\n    parse_url = require('url').parse,\n    EE3 = require('eventemitter3'),\n    http = require('http'),\n    https = require('https'),\n    web = require('./passes/web-incoming'),\n    ws = require('./passes/ws-incoming');\n\nhttpProxy.Server = ProxyServer;\n/**\n * Returns a function that creates the loader for\n * either `ws` or `web`'s  passes.\n *\n * Examples:\n *\n *    httpProxy.createRightProxy('ws')\n *    // => [Function]\n *\n * @param {String} Type Either 'ws' or 'web'\n *Â \n * @return {Function} Loader Function that when called returns an iterator for the right passes\n *\n * @api private\n */\n\nfunction createRightProxy(type) {\n  return function (options) {\n    return function (req, res\n    /*, [head], [opts] */\n    ) {\n      var passes = type === 'ws' ? this.wsPasses : this.webPasses,\n          args = [].slice.call(arguments),\n          cntr = args.length - 1,\n          head,\n          cbl;\n      /* optional args parse begin */\n\n      if (typeof args[cntr] === 'function') {\n        cbl = args[cntr];\n        cntr--;\n      }\n\n      var requestOptions = options;\n\n      if (!(args[cntr] instanceof Buffer) && args[cntr] !== res) {\n        //Copy global options\n        requestOptions = extend({}, options); //Overwrite with request options\n\n        extend(requestOptions, args[cntr]);\n        cntr--;\n      }\n\n      if (args[cntr] instanceof Buffer) {\n        head = args[cntr];\n      }\n      /* optional args parse end */\n\n\n      ['target', 'forward'].forEach(function (e) {\n        if (typeof requestOptions[e] === 'string') requestOptions[e] = parse_url(requestOptions[e]);\n      });\n\n      if (!requestOptions.target && !requestOptions.forward) {\n        return this.emit('error', new Error('Must provide a proper URL as target'));\n      }\n\n      for (var i = 0; i < passes.length; i++) {\n        /**\n         * Call of passes functions\n         * pass(req, res, options, head)\n         *\n         * In WebSockets case the `res` variable\n         * refer to the connection socket\n         * pass(req, socket, options, head)\n         */\n        if (passes[i](req, res, requestOptions, head, this, cbl)) {\n          // passes can return a truthy value to halt the loop\n          break;\n        }\n      }\n    };\n  };\n}\n\nhttpProxy.createRightProxy = createRightProxy;\n\nfunction ProxyServer(options) {\n  EE3.call(this);\n  options = options || {};\n  options.prependPath = options.prependPath === false ? false : true;\n  this.web = this.proxyRequest = createRightProxy('web')(options);\n  this.ws = this.proxyWebsocketRequest = createRightProxy('ws')(options);\n  this.options = options;\n  this.webPasses = Object.keys(web).map(function (pass) {\n    return web[pass];\n  });\n  this.wsPasses = Object.keys(ws).map(function (pass) {\n    return ws[pass];\n  });\n  this.on('error', this.onError, this);\n}\n\nrequire('util').inherits(ProxyServer, EE3);\n\nProxyServer.prototype.onError = function (err) {\n  //\n  // Remark: Replicate node core behavior using EE3\n  // so we force people to handle their own errors\n  //\n  if (this.listeners('error').length === 1) {\n    throw err;\n  }\n};\n\nProxyServer.prototype.listen = function (port, hostname) {\n  var self = this,\n      closure = function (req, res) {\n    self.web(req, res);\n  };\n\n  this._server = this.options.ssl ? https.createServer(this.options.ssl, closure) : http.createServer(closure);\n\n  if (this.options.ws) {\n    this._server.on('upgrade', function (req, socket, head) {\n      self.ws(req, socket, head);\n    });\n  }\n\n  this._server.listen(port, hostname);\n\n  return this;\n};\n\nProxyServer.prototype.close = function (callback) {\n  var self = this;\n\n  if (this._server) {\n    this._server.close(done);\n  } // Wrap callback to nullify server after all open connections are closed.\n\n\n  function done() {\n    self._server = null;\n\n    if (callback) {\n      callback.apply(null, arguments);\n    }\n  }\n\n  ;\n};\n\nProxyServer.prototype.before = function (type, passName, callback) {\n  if (type !== 'ws' && type !== 'web') {\n    throw new Error('type must be `web` or `ws`');\n  }\n\n  var passes = type === 'ws' ? this.wsPasses : this.webPasses,\n      i = false;\n  passes.forEach(function (v, idx) {\n    if (v.name === passName) i = idx;\n  });\n  if (i === false) throw new Error('No such pass');\n  passes.splice(i, 0, callback);\n};\n\nProxyServer.prototype.after = function (type, passName, callback) {\n  if (type !== 'ws' && type !== 'web') {\n    throw new Error('type must be `web` or `ws`');\n  }\n\n  var passes = type === 'ws' ? this.wsPasses : this.webPasses,\n      i = false;\n  passes.forEach(function (v, idx) {\n    if (v.name === passName) i = idx;\n  });\n  if (i === false) throw new Error('No such pass');\n  passes.splice(i++, 0, callback);\n};","map":{"version":3,"sources":["/home/shubhangi/Documents/mentor-and-mentee-tracking-/node_modules/http-proxy/lib/http-proxy/index.js"],"names":["httpProxy","module","exports","extend","require","_extend","parse_url","parse","EE3","http","https","web","ws","Server","ProxyServer","createRightProxy","type","options","req","res","passes","wsPasses","webPasses","args","slice","call","arguments","cntr","length","head","cbl","requestOptions","Buffer","forEach","e","target","forward","emit","Error","i","prependPath","proxyRequest","proxyWebsocketRequest","Object","keys","map","pass","on","onError","inherits","prototype","err","listeners","listen","port","hostname","self","closure","_server","ssl","createServer","socket","close","callback","done","apply","before","passName","v","idx","name","splice","after"],"mappings":"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","sourcesContent":["var httpProxy = module.exports,\n    extend    = require('util')._extend,\n    parse_url = require('url').parse,\n    EE3       = require('eventemitter3'),\n    http      = require('http'),\n    https     = require('https'),\n    web       = require('./passes/web-incoming'),\n    ws        = require('./passes/ws-incoming');\n\nhttpProxy.Server = ProxyServer;\n\n/**\n * Returns a function that creates the loader for\n * either `ws` or `web`'s  passes.\n *\n * Examples:\n *\n *    httpProxy.createRightProxy('ws')\n *    // => [Function]\n *\n * @param {String} Type Either 'ws' or 'web'\n *Â \n * @return {Function} Loader Function that when called returns an iterator for the right passes\n *\n * @api private\n */\n\nfunction createRightProxy(type) {\n\n  return function(options) {\n    return function(req, res /*, [head], [opts] */) {\n      var passes = (type === 'ws') ? this.wsPasses : this.webPasses,\n          args = [].slice.call(arguments),\n          cntr = args.length - 1,\n          head, cbl;\n\n      /* optional args parse begin */\n      if(typeof args[cntr] === 'function') {\n        cbl = args[cntr];\n\n        cntr--;\n      }\n\n      var requestOptions = options;\n      if(\n        !(args[cntr] instanceof Buffer) &&\n        args[cntr] !== res\n      ) {\n        //Copy global options\n        requestOptions = extend({}, options);\n        //Overwrite with request options\n        extend(requestOptions, args[cntr]);\n\n        cntr--;\n      }\n\n      if(args[cntr] instanceof Buffer) {\n        head = args[cntr];\n      }\n\n      /* optional args parse end */\n\n      ['target', 'forward'].forEach(function(e) {\n        if (typeof requestOptions[e] === 'string')\n          requestOptions[e] = parse_url(requestOptions[e]);\n      });\n\n      if (!requestOptions.target && !requestOptions.forward) {\n        return this.emit('error', new Error('Must provide a proper URL as target'));\n      }\n\n      for(var i=0; i < passes.length; i++) {\n        /**\n         * Call of passes functions\n         * pass(req, res, options, head)\n         *\n         * In WebSockets case the `res` variable\n         * refer to the connection socket\n         * pass(req, socket, options, head)\n         */\n        if(passes[i](req, res, requestOptions, head, this, cbl)) { // passes can return a truthy value to halt the loop\n          break;\n        }\n      }\n    };\n  };\n}\nhttpProxy.createRightProxy = createRightProxy;\n\nfunction ProxyServer(options) {\n  EE3.call(this);\n\n  options = options || {};\n  options.prependPath = options.prependPath === false ? false : true;\n\n  this.web = this.proxyRequest           = createRightProxy('web')(options);\n  this.ws  = this.proxyWebsocketRequest  = createRightProxy('ws')(options);\n  this.options = options;\n\n  this.webPasses = Object.keys(web).map(function(pass) {\n    return web[pass];\n  });\n\n  this.wsPasses = Object.keys(ws).map(function(pass) {\n    return ws[pass];\n  });\n\n  this.on('error', this.onError, this);\n\n}\n\nrequire('util').inherits(ProxyServer, EE3);\n\nProxyServer.prototype.onError = function (err) {\n  //\n  // Remark: Replicate node core behavior using EE3\n  // so we force people to handle their own errors\n  //\n  if(this.listeners('error').length === 1) {\n    throw err;\n  }\n};\n\nProxyServer.prototype.listen = function(port, hostname) {\n  var self    = this,\n      closure = function(req, res) { self.web(req, res); };\n\n  this._server  = this.options.ssl ?\n    https.createServer(this.options.ssl, closure) :\n    http.createServer(closure);\n\n  if(this.options.ws) {\n    this._server.on('upgrade', function(req, socket, head) { self.ws(req, socket, head); });\n  }\n\n  this._server.listen(port, hostname);\n\n  return this;\n};\n\nProxyServer.prototype.close = function(callback) {\n  var self = this;\n  if (this._server) {\n    this._server.close(done);\n  }\n\n  // Wrap callback to nullify server after all open connections are closed.\n  function done() {\n    self._server = null;\n    if (callback) {\n      callback.apply(null, arguments);\n    }\n  };\n};\n\nProxyServer.prototype.before = function(type, passName, callback) {\n  if (type !== 'ws' && type !== 'web') {\n    throw new Error('type must be `web` or `ws`');\n  }\n  var passes = (type === 'ws') ? this.wsPasses : this.webPasses,\n      i = false;\n\n  passes.forEach(function(v, idx) {\n    if(v.name === passName) i = idx;\n  })\n\n  if(i === false) throw new Error('No such pass');\n\n  passes.splice(i, 0, callback);\n};\nProxyServer.prototype.after = function(type, passName, callback) {\n  if (type !== 'ws' && type !== 'web') {\n    throw new Error('type must be `web` or `ws`');\n  }\n  var passes = (type === 'ws') ? this.wsPasses : this.webPasses,\n      i = false;\n\n  passes.forEach(function(v, idx) {\n    if(v.name === passName) i = idx;\n  })\n\n  if(i === false) throw new Error('No such pass');\n\n  passes.splice(i++, 0, callback);\n};\n"]},"metadata":{},"sourceType":"script"}